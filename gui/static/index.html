<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    
    <title>pyProClust: easy clustering for biomolecules</title>
    
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.10.2.custom.min.css" media="screen">
<!--     <link rel="stylesheet" type="text/css" href="css/ui/jquery.ui.selectmenu.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/ui/jquery.tagit.css" media="screen"> -->
    <link rel="stylesheet" type="text/css" href="css/basic.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/wizard.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/dynamicList.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/fileBrowser.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="js/jquery/filetree/filetree.css"  media="screen">
    
    <!-- JQUERY -->
    <script type="text/javascript" src="js/jquery/jquery-1.9.1.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/jquery-ui-1.10.0.custom.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/ui/selectmenu/jquery.ui.selectmenu.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/center/jquery.center.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/wizard/jquery.wizard.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/form/jquery.form.js"></script>
    <script type="text/javascript" src="js/jquery/validate/jquery.validate.js"></script>
    <script type="text/javascript" src="js/jjquery/filetree/filetree.js" charset="utf-8"></script>
    
    <!-- HANDLEBARS -->
    <script type="text/javascript" src="js/handlebars/handlebars-1.0.rc.1.min.js" charset="utf-8"></script>
    
    <!-- CUSTOM SCRIPTS -->
    <script type="text/javascript" src="js/tools.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/path_tools.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/cluster_params_field_templating.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/evaluation_criteria_handling.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/click_behaviour.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/params_gathering.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/algorithm_parameters_definition.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/algorithm_definitions.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/query_and_criteria_definitions.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/base_parameters_definition.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/parameter_sintatic_checking.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/algorithm_parameter_parsers.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/dialogs.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/run_script.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/save_script.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/dialogs.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/main.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/dynamicList.js" charset="utf-8"></script>
    
    <script>
        $(document).ready( function() {
           
            main_function();
            
            var dl = new DynamicList("#trajectory_list",["Add","Remove"]);
            
            dl.buttons["Add"].click(function(){
                dl.addElement("LOL");
            })
            
            dl.buttons["Remove"].click(function(){
                dl.deleteSelectedElements();
            })
            
            $("#browse_project_folder_button").click(function(){
                browsing_dialog("folder");
            });
            
            $("#wizard-wrapper").wizard({
		        stepsWrapper: "#steps-wrapper",
		        forward: ".forward",
		        backward: ".backward",
		
		    // Validation of forward transitions
		    beforeForward: function(event, state) {	
		        var step = $(state.step[0]);
		        var step_id = state.step[0].id;
		        
		        if(step.data == undefined){
		            step.data = {invalidate_next_check: false};
		            console.log("att creation")
		        }
		        
		        if(step.data.invalidate_next_check){
		            console.log("jumping")
		            step.data.invalidate_next_check = false;
		            return true;
		        }
		        
		        console.log(step_id)
		        switch(step_id){
		            
		            // Simulated transition (wizard.js does not allow to do it)
		            // That comes from workspace-1
		            case 'trajectory-1':
		                var previous_step = $("#wizard-wrapper").wizard("step","workspace-1");
		                console.log(previous_step.attr("id"))
		                var file_path = previous_step.find("#workspace_base").val();
		                var file_check  = file_exists(file_path);
				        if(file_check["exists"]){
				            if($("#erase_workspace").is(":checked")){
				                alert("TODO: erasing");
				            }
				            return true;
				        }
				        else{
				            var create_new_folder_question = yes_or_no_dialog ("Warning","Folder does not exist, do you want to create it?");
        
                            create_new_folder_question.done(function(){
                                console.log("yeah");
                                step.data.invalidate_next_check = true;
                                create_folder(file_path);
                                $("#wizard-wrapper").wizard("forward",[event,1]);
                            });
				        }
                    break;
                    
                    default:
                        var inputs = step.find(':input');
                        //return !inputs.length || !!inputs.valid();
                        return true;
			
			        // La comprobación de si el fichero existe va aquí.
		        }
		        
		        return false;
		    },
		
		    // Where to go in transitions
		    transitions: {
			    'matrix-creation-options': function( $step, action ) {
				    // The branch to go changes to reflect your choice.
				    var branch = $step.find("[name=matrix-creation-options]:checked").val();
				    return branch;
			    }
		    }
	        })
	        .wizard('form')
	        .validate(
	        {
		        errorPlacement: function(error, element) { 
			        if ( element.is(':radio') || element.is(':checkbox') ) {
				        error.insertBefore( element.next() );
			        } 
			        else { 
				        error.insertAfter( element );
			        }
		        }
                });
        	 });
        
    </script>
  </head>
  <body> 
<div class = 'main_frame' id="main"> 
    
  <div class = 'main_title_container'>
      <img src="images/pyproclust.png" > </img>
  </div>
  
  <div class = 'main_window'> 
  
    <div id="wizard-wrapper" >
        <form name="main" id="steps-wrapper" class="step_wrapper">
        
		<!-- ------------- -->
		<!-- ACTION CHOICE -->
		<!-- ------------- -->
		<div class="step">
			<div class="step_header">
				<h2>What's your goal?</h2>
			</div>
	
			<div class = "step_body">		
				<div id="action_group_wrapper">
					<label for="action_clusters">
						<input type="radio" id = "action_clusters" name="action_group" value ="clustering" checked/> 
					Get clusters from a trajectory </label> </br>
						
					<label for="action_compress">
						<input type="radio" id = "action_compress" name="action_group" value="compression"/> 
					Compress a trajectory</label></br>
					
					<label for="action_compare">
						<input type="radio" id = "action_compare" name="action_group" value="comparison" disabled/>
					Compare trajectories</label></br>
					
				</div>
			</div>
		</div>
		<!-- --------- -->
		<!-- WORKSPACE -->
		<!-- --------- -->
		<div class="step" id = "workspace-1" data-state="trajectory-1">
			<div class="step_header">
				<h2>Project's workspace:</h2>
			</div>
			
			<div class = "step_body">	
				<label for="workspace_base"> Project folder:</label> </br>
                	<input class = "text_field_widget required" id="workspace_base" type= "text" value = "/home/victor/Escritorio/test2">
                	<div class = "button_widget" id = "browse_project_folder_button" > Browse </div>
            	</br>
            	</br>
            	<input id="erase_workspace" type = "checkbox" >
            	<label for="erase_workspace"> If folder exists, erase contents.</label>
			</div>
		</div>
		<!-- --------- -->
		<!-- TEMPORARY STATE -->
		<!-- --------- -->
		<div class="step" id = "tmp-state" data-state="trajectory-1">
			<div class="step_header">
				<h2>--Temporary State--</h2>
			</div>
			
			<div class = "step_body">	
			</div>
		</div>
		<!-- ------------ -->
		<!-- TRAJECTORIES -->
		<!-- ------------ -->
		<div class="step" id = "trajectory-1">
			<div class="step_header">
            	<h2>Add the trajectories you want to work with:</h2>
            </div>
            
            <div class = "step_body">
                <label for="global::pdbs"> Trajectories: </label>
                    
                <ul id = "trajectory_list" />
                     
			</div>
		</div>
		
		<!-- ---------------- -->
		<!-- MATRIX OBTENTION -->
		<!-- ---------------- -->
		<div class="step" data-state="matrix-creation-options">
			<div class="step_header">
				<h2>Choose how do you want to obtain the matrix:</h2>
			</div>
			
			<div class = "step_body">
				<input type="radio" checked id = "matrix::creation::rmsd" name="matrix-creation-options" value ="rmsd"/>
				<label for = "matrix::creation::rmsd"> Calculate RMSD </label>
				</br>
				
				<input type="radio" id = "matrix::creation::distance" name="matrix-creation-options" value ="distance"/>
				<label for = "matrix::creation::distance">Calculate euclidean distances </label> 
				</br>
				
				<input type="radio" id = "matrix::creation::load" name="matrix-creation-options" value ="load"/>
				<label for = "matrix::creation::load">Load from disk</label> 
				</br>
			</div>
		</div>
		
		<div class="branch" id='rmsd'>
			<div class="step" >
				<div class="step_header">
					<h2>Define the part of the molecule used for superposition:</h2>
				</div>
				
				<div class = "step_body">
					<label for="matrix::creation::fit_selection"> Selection: </label>
                            		<input class = "parameter text_field_widget" id="matrix::creation::fit_selection" type="text">
				</div>
			</div>
			
			<div class="step" data-state="matrix-end">
				<div class="step_header">
					<h2>Define the part of the molecule used to calculate the RMSD:</h2>
				</div>
				<div class="step_help">
					<h3> If this field is left blank, the selection used for superposition will be used.</h3>
				</div>
				<div class = "step_body">
					<label for="matrix::cretion::calc_selection"> Selection: </label>
                            		<input class = "parameter text_field_widget" id="matrix::creation::rmsd_selection" 
                            		name="matrix::creation::rmsd_selection" type="text">
				</div>
			</div>
		</div>
	
		<div class="branch" id='distance'>
			<div class="step" >
				<div class="step_header">
					<h2>Define the part of the molecule used for superposition:</h2>
				</div>
				
				<div class="step_help">
					<h3>An iterative superposition algorithm will be used to superpose frames.</h3>	
				</div>
				
				<div class = "step_body">
					<label for="matrix::creation::fit_selection"> Selection: </label>
                            		<input class = "parameter text_field_widget" id="matrix::creation::fit_selection" type="text">
				</div>
			</div>
			
			<div class="step" data-state="matrix-end">
				<div class="step_header">
					<h2>Define the part of the molecule used to calculate the euclidean distance:</h2>
				</div>
				
				<div class = "step_body">
					<label for="matrix::creation::calc_selection"> Selection: </label>
                            		<input class = "parameter text_field_widget" id="matrix::creation::rmsd_selection" type="text">
				</div>
			</div>
		</div>
		
		<div class="branch" id = 'load'>
			<div class="step" data-state="matrix-end">
				 <div class="step_header">
					<h2>Choose the file to load:</h2>
				</div>
				 
				 <div class = "step_body">
					 <label for="matrix::creation::path"> File: </label>
		                         <input class = "parameter text_field_widget" id="matrix::creation::path" type="text">
				</div>
			</div>
		</div>
		
		<!-- ---------- -->
		<!-- ALGORITHMS -->
		<!-- ---------- -->
		<div class="step" id='matrix-end'>
			<div class="step_header">
				<h2> Choose the algorithms that you want to use:</h2>
			</div>
			<div class = "step_body">
				<div>Add</div>
	                    	<select class="selection_widget" id="algorithms_listbox"></select>
	                    	
	                    	<div class="button_widget" id ="add_clustering_algorithm">+</div>
			        <div id="algorithms_field" >
				        <div id = "gromos_field"></div>
				        <div id = "kmedoids_field"></div>
				        <div id = "hierarchical_field"></div>
				        <div id = "spectral_field"></div>
				        <div id = "dbscan_field"></div>
				        <div id = "random_field"></div>
	        	        </div>
	        	</div>
		</div>
		
		<!-- ---------- -->
		<!-- CRITERIA-->
		<!-- ---------- -->
		<div class="step" >
			<div class="step_header">
				<h2>---:</h2>
			</div>
			
			<div class = "step_body">
		            <label for = "evaluation::maximum_noise">Maximum noise (%)</label>
	                    	<input class = "parameter spinner_widget" id="evaluation::maximum_noise" value = "15"> </br>
	                    	
	                    <label for = "evaluation::minimum_clusters" > Minimum number of clusters:   </label>
	                    	<input class = "parameter spinner_widget" id="evaluation::minimum_clusters" value = "10"></br>
	                    
	                    <label for = "evaluation::maximum_clusters"> Maximum number of clusters:   </label>
	                    	<input class = "parameter spinner_widget" id="evaluation::maximum_clusters" value = "30"></br>
	                    
	                    <label for = "evaluation::minimum_cluster_size"> Minimum cluster size (elements):   </label>
	                    	<input class = "parameter spinner_widget" id="evaluation::minimum_cluster_size" value = "50"></br>
	                    
	                    <label for = "query_listbox">Add query</label>
	                    	<select class="selection_widget" id="query_listbox"/>
	                    	<div class="button_widget" id = "add_query_button">+</div>
	                    
                    	<input class = "parameter tag_widget" id="evaluation::query_types"  type="text">
                    </div>
                    
           	</div>
           	
           	<div class="step" >
           	    <div class = "step_body">
	           	<label for="add_evaluation_criteria_button">Add new e valuation criteria </label> 
	                <div class="button_widget" id = "add_evaluation_criteria_button">+</div>
                    	<input class = "parameter tag_widget" id="evaluation::evaluation_criteria"  type="text">
                    </div>
           	</div>
		
		<!-- ---------- -->
		<!-- NAVIGATION -->
		<!-- ---------- -->
		<div class="navigation" id="navigation">
			<ul class="clearfix">
				<li><button type="button" name="forward" class="forward">Forward</button></li>
				<li><button type="button" name="backward" class="backward">Backward</button></li>
			</ul>
		</div>
	   </form>	
      </div>
    </div>
</div>
</body>
</html>
