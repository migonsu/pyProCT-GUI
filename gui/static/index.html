<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    
    <title>pyProClust: easy clustering for biomolecules</title>
    
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.10.2.custom.min.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/ui/jquery.ui.selectmenu.css" media="screen">
    <!-- <link rel="stylesheet" type="text/css" href="css/ui/jquery.tagit.css" media="screen"> -->
    <link rel="stylesheet" type="text/css" href="css/basic.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/wizard.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/dynamicList.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/fileBrowser.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="js/jquery/filetree/filetree.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/chemdoodle/ChemDoodleWeb.css"  media="screen">
    
    <!-- JQUERY -->
    <script type="text/javascript" src="js/jquery/jquery-1.9.1.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/ui/jquery-ui-1.10.0.custom.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/ui/selectmenu/jquery.ui.selectmenu.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/ui/dynamiclist/jquery.ui.dynamiclist.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/center/jquery.center.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/wizard/jquery.wizard.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/form/jquery.form.js"></script> 
    <script type="text/javascript" src="js/jquery/validate/jquery.validate.js"></script>
    <script type="text/javascript" src="js/jquery/filetree/filetree.js" charset="utf-8"></script>
    
    <!-- HANDLEBARS -->
    <script type="text/javascript" src="js/handlebars/handlebars-1.0.rc.1.min.js" charset="utf-8"></script>
    
    <!-- CHEMDOODLE -->
    <script type="text/javascript" src="js/chemdoodle/ChemDoodleWeb-libs.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/chemdoodle/ChemDoodleWeb.js" charset="utf-8"></script>
    
    <!-- SPINJS -->
    <script type="text/javascript" src="js/spinjs/spin.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/spinjs/jquery.spin.js" charset="utf-8"></script>    
    
    <!-- CUSTOM SCRIPTS -->
    <script type="text/javascript" src="js/tools.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/path_tools.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/cluster_params_field_templating.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/evaluation_criteria_handling.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/click_behaviour.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/params_gathering.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/algorithm_parameters_definition.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/algorithm_definitions.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/query_and_criteria_definitions.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/base_parameters_definition.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/parameter_sintatic_checking.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/algorithm_parameter_parsers.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/dialogs.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/run_script.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/save_script.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/dialogs.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/main.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/selection_preview_handling.js" charset="utf-8"></script>
    
    <script>
        $(document).ready( function() {
        	//------------------
            // Template Loading
            //------------------
            var	dialog_contents_template = load_text_resource_with_ajax("/templates/dialog_contents.template");
            var algorithm_wizard_steps = load_text_resource_with_ajax("/templates/algorithm.wizard.template");
            
            main_function();
            

            

            $("#trajectory_list").dynamiclist({height:150,buttons:["Add","Remove"]});
            var dl = $("#trajectory_list").dynamiclist("getListHandler");
            //dl.addElement('/home/victor/Desktop/test/1M94.pdb');
            dl.addElement('/home/victor/Escritorio/test/ubi_9_clusters.pdb');
            dl.buttons["Add"].click(function(){
            	var callback = function(value){
            		dl.addElement(value);
                };
            	browsing_dialog("file::pdb", callback);
            });
            
            dl.buttons["Remove"].click(function(){
                dl.deleteSelectedElements();
            });
            
            $("#algorithms_list").dynamiclist({height:160,buttons:["Algorithms","Add","Remove"]});
            var dl2 = $("#algorithms_list").dynamiclist("getListHandler");
            dl2.buttons["Algorithms"].replaceWith("<select class='dynListButton' id = 'algorithms_listbox'></select>")
         	// Add options to the cluster algorithms selection widget
           	$("#algorithms_listbox").append("<option id='all_option'>All</option>");
            for (clustering_algorithm in clustering_algorithm_titles){
                var title = clustering_algorithm_titles[clustering_algorithm];
                $("#algorithms_listbox").append("<option id='"+clustering_algorithm+"_option'>"+title+"</option>");
            }
            dl2.buttons["Add"].click(function(){
            	var algorithm = $("#algorithms_listbox option:selected").val();
            	if (algorithm != "All"){
            		dl2.addUniqueElement(algorithm);
            	}
            	else{
            		for (clustering_algorithm in clustering_algorithm_titles){
            			dl2.addUniqueElement(clustering_algorithm_titles[clustering_algorithm]);
            		}
            	}
            });
            dl2.buttons["Remove"].click(function(){
                dl2.deleteSelectedElements();
            });
            
            $("#query_list").dynamiclist({height:160,buttons:["Queries","Add","Remove"]});
            var dl4 = $("#query_list").dynamiclist("getListHandler");
            dl4.buttons["Queries"].replaceWith("<select class='dynListButton' id = 'queries_listbox'></select>")
            // Add options to the query listbox
            for (var i = 0; i < query_types.length; i++){
                $("#queries_listbox").append("<option>"+query_types[i]+"</option>");
            }
            dl4.buttons["Add"].click(function(){
                dl4.addUniqueElement($("#queries_listbox option:selected").val());
            });
            dl4.buttons["Remove"].click(function(){
                dl4.deleteSelectedElements();
            });
            
            $("#criteria_list").dynamiclist({height:155,buttons:["Add Criteria","Remove"]});
            var dl3 = $("#criteria_list").dynamiclist("getListHandler");
            dl3.buttons["Add Criteria"].click(function(){
                criteria_creation_show_dialog(
			                			criteria_types, 
			                			dl3, 
			                        	dialog_contents_template);
            });
            dl3.buttons["Remove"].click(function(){
                dl3.deleteSelectedElements();
            });
            
            
            create_previewer(
            		'matrix\\:\\:creation\\:\\:fit_selection',
            		"preview_rmsd_fit_button",
            		"trajectory_list", 
            		"workspace_base",
            		'fittingViewer');
            
			/*create_previewer(
            		'matrix\\:\\:creation\\:\\:calc_selection',
            		"preview_rmsd_calc_button",
            		"trajectory_list", 
            		"workspace_base",
            		'calcViewer');*/
			
            $("#browse_project_folder_button").click(function(){
                var callback = function(value){
                	$("#workspace_base").val(value);
                };
            	browsing_dialog("folder", callback);
            });
            
            $.validator.addMethod(
           		'listnotempty', 
           		function(value, element){
   	            	return true;//$(element).text()!="";
   	        	},
   	        	'This list cannot be empty.'
            ); 
            
            var selected_algorithms ;
            
            $("#wizard-wrapper").wizard({
		        stepsWrapper: "#steps-wrapper",
		        
		        forward: ".forward",
		        
		        backward: ".backward",
		
			    onForwardMove: function(event, state) {	
			        
			    	var step = $(state.step[0]);
			        var step_id = state.step[0].id;
			        
			        console.log(step_id)
			        switch(step_id){
			            case 'workspace-1':
			                var file_path = $("#wizard-wrapper")
			                						.wizard("step","workspace-1")
			                						.find("#workspace_base")
			                						.val();
					        if(file_path!=""){
				                var file_check  = file_exists(file_path);
				                
				                if(file_check["exists"]){
						            return true;
						        }
						        else{
						            var create_new_folder_question = yes_or_no_dialog ("Warning",
						            		"Folder does not exist, do you want to create it?");
		        
		                            create_new_folder_question.done(function(){
		                                create_folder(file_path);
		                                $("#wizard-wrapper").wizard("forward",[event,1]);
		                            });
						        }
					        }
					        else{
					        	warning_dialog ("The field cannot be empty.");
					        }
	                    	break;
	                    
			            case 'trajectory-1':
			            	if (!$("#trajectory_list").dynamiclist("isEmpty")){
				            	return true;
			            	}
			            	else{
			            		warning_dialog ("You have to add at least one trajectory.");
			            	}
			            	break;
	                    
			            case 'algorithms-1':
			            	var list = step.find(":custom-dynamiclist");
			            	selected_algorithms = list.dynamiclist("getValue").split(",");
			            	return true;
			           		break;
	                    
	                    // What to do in the other cases
	                    default:
	                    	console.log("default validation")
	                        var inputs = step.find(':input');
	                    	
	                        if (inputs.size() == 0){
	                        	console.log("Input fields NOT found @ this step")
	                        	return true;
	                        }
	                        else{
	                        	console.log("Input fields found:")
	                        	if(inputs.length > 1){
	    	                    	for(var i = 0; i < inputs.size(); i++){
	    	                    		console.log("* "+$(inputs[i]).attr("id"));
	    	                    		if ($(inputs[i]).attr("name") == undefined){
	    	                    			$(inputs[i]).attr("name", $(inputs[i]).attr("id"))
	    	                    		}
	    	                    	}
	                        	}
	                            return inputs.valid();
	                        }
				
			        }
			        
			        return false;
			    },
			    
			    afterForward:function(event, state) {
			    	var step = $(state.step[0]);
			        var step_id = state.step[0].id;
			        
			        // detect an algorithm transition
			    	if(step_id.indexOf("algorithm-")!=-1){
			    		var algorithm_id = step_id.substring(10);
			    		console.log(algorithm_id)
			    		if($("#algorithms_list").dynamiclist("getListHandler").isAlreadyInTheList(clustering_algorithm_titles[algorithm_id])){
			    			console.log(algorithm_id+" it's being selected")
			    		}
			    		else{
			    			$("#wizard-wrapper").wizard("forward",[event,1]);
			    		}
			    	}
			    },
			    
			    afterBackward:function(event, state) {
			    	var step = $(state.step[0]);
			        var step_id = state.step[0].id;
			        
			        // detect an algorithm transition
			    	if(step_id.indexOf("algorithm-")!=-1){
			    		var algorithm_id = step_id.substring(10);
			    		console.log(algorithm_id)
			    		if($("#algorithms_list").dynamiclist("getListHandler").isAlreadyInTheList(clustering_algorithm_titles[algorithm_id])){
			    			console.log(algorithm_id+" it's being selected")
			    		}
			    		else{
			    			$("#wizard-wrapper").wizard("backward",[event,1]);
			    		}
			    			
			    	}
			    },
			    // Where to go in transitions
			    transitions: {
				    'matrix-creation-options': function( $step, action ) {
					    // The branch to go changes to reflect your choice.
					    var branch = $step.find("[name=matrix-creation-options]:checked").val();
					    return branch;
				    }
			    }
	        })
	        .wizard('form')
	        .validate();
    	}); 
        
    </script>
  </head>
  <body> 
<div class = 'main_frame' id="main"> 
    
  <div class = 'main_title_container'>
      <img src="images/pyproclust.png" >
  </div>
  
  <div class = 'main_window'> 
  
    <div id="wizard-wrapper" >
        <form name="main" id="steps-wrapper" class="step_wrapper">
        
		<!-- ------------- -->
		<!-- ACTION CHOICE -->
		<!-- ------------- -->
		<div class="step">
			<div class="step_header">
				<h2>What's your goal?</h2>
			</div>
	
			<div class = "step_body">		
				<div id="action_group_wrapper">
					<label for="action_clusters">
						<input type="radio" id = "action_clusters" name="action_group" value ="clustering" checked/> 
					Get clusters from a trajectory </label> </br>
						
					<label for="action_compress">
						<input type="radio" id = "action_compress" name="action_group" value="compression"/> 
					Compress a trajectory</label></br>
					
					<label for="action_compare">
						<input type="radio" id = "action_compare" name="action_group" value="comparison" disabled/>
					Compare trajectories</label></br>
					
				</div>
			</div>
		</div>
		
		<!-- --------- -->
		<!-- WORKSPACE -->
		<!-- --------- -->
		<div class="step" id = "workspace-1" data-state="trajectory-1">
			<div class="step_header">
				<h2>Project's workspace:</h2>
			</div>
			
			<div class = "step_body">	
				<label for="workspace_base"> Project folder:</label> 
               	<input class = "text_field_widget required" name="workspace_base" id="workspace_base" type= "text" value = "/home/victor/Escritorio/test">
               	<div class = "button_widget" id = "browse_project_folder_button" > Browse </div>
			</div>
		</div>
		
		<!-- ------------ -->
		<!-- TRAJECTORIES -->
		<!-- ------------ -->
		<div class="step" id = "trajectory-1">
			<div class="step_header">
            	<h2>Add the trajectories you want to work with:</h2>
            </div>
            
            <div class = "step_body">
                <label for="trajectory_list"> Trajectories: </label>
                <ul id = "trajectory_list" name = 'trajectory_list' class="listnotempty"> </ul>
			</div>
		</div>
		
		<!-- ---------------- -->
		<!-- MATRIX OBTENTION -->
		<!-- ---------------- -->
		<div class="step" data-state="matrix-creation-options">
			<div class="step_header">
				<h2>Choose how do you want to obtain the matrix:</h2>
			</div>
			
			<div class = "step_body">
				<input type="radio" checked id = "matrix::creation::rmsd" name="matrix-creation-options" value ="rmsd"/>
				<label for = "matrix::creation::rmsd"> Calculate RMSD </label>
				</br>
				
				<input type="radio" id = "matrix::creation::distance" name="matrix-creation-options" value ="distance"/>
				<label for = "matrix::creation::distance">Calculate euclidean distances </label>
				</br>
				
				<input type="radio" id = "matrix::creation::load" name="matrix-creation-options" value ="load"/>
				<label for = "matrix::creation::load">Load from disk</label>
				</br>
			</div>
		</div>
		
		<div class="branch" id='rmsd'>
			<div class="step" >
				<div class="step_header">
					<h2>Define the part of the molecule used for superposition:</h2>
				</div>
				
				<div class = "step_body">
					<table>
						<tr><td style="width: 50%;">
							<table>
								<tr ><td style="height:65px;">
									<label for="matrix::creation::fit_selection" > Superposition selection: </label>
			                    	<input class = "parameter text_field_widget" id="matrix::creation::fit_selection"  type="text">
									<div class = "button_widget" id = "preview_rmsd_fit_button" > 
										<span class='ui-icon ui-icon-search'> </span></div> 
									<input id = "usesamefitandcalc" type='checkbox' checked/>
									<label for="usesamefitandcalc" class = "small" > Use same selection for superposition and RMSD calculation</label>
								</td></tr><tr ><td style="height:65px;">
								</td></tr><tr ><td style="height:65px;">
									<br>
									<label for="matrix::creation::fit_selection" class="disabled"> Calculation selection: </label>
			                    	<input class = "parameter text_field_widget" id="matrix::creation::calc_selection"  type="text" disabled>
									<div class = "button_widget " id = "preview_rmsd_calc_button" disabled>
										<span class='ui-icon ui-icon-search'> </span></div>
								</td></tr>
							</table>
						</td><td style="width: 50%;">
							<canvas id="fittingViewer">This browser does not support HTML5/Canvas.</canvas>
						</td></tr>
					</table>
					
				</div>
			</div>
			
			<div class="step" data-state="algorithms-1">
				<div class="step_header">
					<h2>Define the part of the molecule used to calculate the RMSD:</h2>
				</div>
				
				<div class = "step_body">
					<table>
						<tr><td style="width: 20%;">
						<!--<label for="matrix::creation::calc_selection" > Selection: </label>-->
                    	</td><td style="width: 30%;">
                    	<input class = "parameter text_field_widget" id="matrix::creation::calc_selection" type="text">
						</td><td style="width: 25%;">
						<div class = "button_widget" id = "preview_rmsd_calc_button" > Preview </div>
						</td><td style="width: 25%;">
						</td></tr>
					</table>
					
					<canvas id="calcViewer">This browser does not support HTML5/Canvas.</canvas>
				</div>
			</div>
		</div>
	
		<div class="branch" id='distance'>
			<div class="step" >
				<div class="step_header">
					<h2>Define the part of the molecule used for superposition:</h2>
				</div>
				
				<div class="step_help">
					An iterative superposition algorithm will be used to superpose frames.	
				</div>
				
				<div class = "step_body">
					<label for="matrix::creation::fit_selection"> Selection: </label>
               		<input class = "parameter text_field_widget" id="matrix::creation::fit_selection" type="text">
				</div>
			</div>
			
			<div class="step" data-state="algorithms-1">
				<div class="step_header">
					<h2>Define the part of the molecule used to calculate the euclidean distance:</h2>
				</div>
				
				<div class = "step_body">
					<label for="matrix::creation::calc_selection"> Selection: </label>
               		<input class = "parameter text_field_widget" id="matrix::creation::rmsd_selection" type="text">
				</div>
			</div>
		</div>
		
		<div class="branch" id = 'load'>
			<div class="step" data-state="algorithms-1">
				 <div class="step_header">
					<h2>Choose the file to load:</h2>
				</div>
				 
				 <div class = "step_body">
					 <label for="matrix::creation::path"> File: </label>
		             <input class = "parameter text_field_widget" id="matrix::creation::path" type="text">
				</div>
			</div>
		</div>
		
		<!-- ---------- -->
		<!-- ALGORITHMS -->
		<!-- ---------- -->
		<div class="step" id='algorithms-1'>
			<div class="step_header">
				<h2> Choose the algorithms that you want to use:</h2>
			</div>
			<div class = "step_body">
	        	<label for="algorithms_list"> Algorithms to use: </label>
                <ul id = "algorithms_list" name ='algorithms_list' class="listnotempty"> </ul>
             </div>
		</div>
		
		
		<!-- ---------- -->
		<!-- CRITERIA-->
		<!-- ---------- -->
		<div class="step" >
			<div class="step_header">
				<h2>Define clustering's desired properties:</h2>
			</div>
			
			<div class = "step_body">
					
					<table><tr><td>
		            <label for = "evaluation::maximum_noise" >Maximum noise (%)</label>
		            </td><td>
	                <input class = "parameter spinner_widget" id="evaluation::maximum_noise" value = "15">
	                </td>
					
					<tr><td>
                    <label for = "evaluation::minimum_clusters"> Minimum number of clusters:   </label>
                    </td><td>
                    <input class = "parameter spinner_widget" id="evaluation::minimum_clusters" value = "10"></br>
	                </td></tr>    
                    
                    <tr><td>
                    <label for = "evaluation::maximum_clusters" class="left_column"> Maximum number of clusters:   </label>
                   	</td><td>
                   	<input class = "parameter spinner_widget" id="evaluation::maximum_clusters" value = "30"></br>
                    </td></tr>    
                    
                    <tr><td>
                    <label for = "evaluation::minimum_cluster_size"> Minimum cluster size (elements):   </label>
                    </td><td>
                    <input class = "parameter spinner_widget" id="evaluation::minimum_cluster_size" value = "50"></br>
                    </td></tr></table>
                    
                </div>
           	</div>
           	
           	<div class="step" >
	           	<div class="step_header">
					<h2>Which information do you want to get from the clustering?</h2>
				</div>
				
           	    <div class = "step_body">
           	    	<label for="query_list"> Queries: </label>
               		<ul id = "query_list" name = 'query_list' class="listnotempty"> </ul>
	            </div>
           	</div>
           	
           	<div class="step" >
	           	<div class="step_header">
					<h2>Which criteria do you want to use?</h2>
				</div>
				
           	    <div class = "step_body">
	            	<label for="criteria_list"> Evaluation criteria: </label>
               		<ul id = "criteria_list" name = 'criteria_list' class="listnotempty"> </ul>
	            </div>
           	</div>
           	
		
		<!-- ---------- -->
		<!-- NAVIGATION -->
		<!-- ---------- -->
		<div class="navigation" id="navigation">
			<ul class="clearfix">
				<li><button type="button" name="forward" class="forward">Forward</button></li>
				<li><button type="button" name="backward" class="backward">Backward</button></li>
			</ul>
		</div>
	   </form>	
      </div>
    </div>
</div>
</body>
</html>
